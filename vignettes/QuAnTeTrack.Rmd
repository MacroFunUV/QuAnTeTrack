---
title: "QuAnTeTrack"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{QuAnTeTrack}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 16,
  fig.height = 8,
  fig.retina = NULL,
  out.width = "100%"
)
```

```{css, echo=FALSE}
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 150px;
}
```

```{r, include = FALSE}
if (Sys.getenv("RGL_USE_NULL") == "" && !interactive()) {
  Sys.setenv(RGL_USE_NULL = "TRUE")
}
```

```{r setup}
library(QuAnTeTrack)
```

## **Introduction**  
This vignette demonstrates how to **load, process, and analyze trackway data** using the **QuAnTeTrack** package. We will walk through two datasets:

### **Paluxy River Dataset**  
Tracks **without missing footprints**. This dataset represents dinosaur tracks from the Paluxy River site, described by **Farlow et al. (2012)**.  
**Source:** *Farlow, J. O., O’Brien, M., Kuban, G. J., Dattilo, B. F., Bates, K. T., Falkingham, P. L., & Piñuela, L. (2012). Dinosaur Tracksites of the Paluxy River Valley (Glen Rose Formation, Lower Cretaceous), Dinosaur Valley State Park, Somervell County, Texas. In Proceedings of the V International Symposium about Dinosaur Palaeontology and their Environment (pp. 41-69). Burgos: Salas de los Infantes.*

### **Mount Tom Dataset**  
Tracks **with missing footprints**. This dataset is based on dinosaur tracks from the Mount Tom site, originally described by **Ostrom (1972)**.  
**Source:** *Ostrom, J. H. (1972). Were some dinosaurs gregarious? Palaeogeography, Palaeoclimatology, Palaeoecology, 11(4), 287-301.*

---

## **Raw Data Format**  
**QuAnTeTrack** accepts raw data in the form of **.TPS files** containing footprint coordinates. Each track should be recorded as a different image within the **.TPS file**.  

### **Requirements**  
- **Footprint coordinates** should be digitized in **equivalent positions** for each track.  
- **Tracks with missing footprints** are acceptable and will be **interpolated** as needed by the package functions.  
- It is **recommended** to digitize the coordinates using the **TPS software suite**, particularly:  
  - **TPSUTIL** (*Rohlf, 2008*) - for file manipulation and data conversion.  
  - **tpsDig** (*Rohlf, 2009*) - for digitizing landmarks and outlines.  

---

## **TPS Software Citation**  
- **Rohlf, F. J.** 2008. **TPSUTIL. Version 1.40.** Department of Ecology and Evolution, State University of New York.  
  Available at: [https://sbmorphometrics.org/](https://sbmorphometrics.org/)  

- **Rohlf, F. J.** 2009. **tpsDig. Version 2.14.** Department of Ecology and Evolution, State University of New York.  
  Available at: [https://sbmorphometrics.org/](https://sbmorphometrics.org/)

---

## **Step 1: Loading and Converting Data**  
The **`tps_to_track()`** function is a fundamental tool for converting raw `.TPS` files containing digitized trackway data into usable track objects within the **QuAnTeTrack** package.  

### **What this function does:**  
1. **Reads .TPS files:** It processes digitized data files where each track is represented as a series of coordinates (landmarks) saved as different images. These files are typically generated using software like **TPSUTIL** or **tpsDig**.  
2. **Converts data to a track object:** The output is a structured object in R that contains two main components:  
   - **Footprints:** The original footprint data, stored as data frames with coordinates and metadata.  
   - **Trajectories:** Interpolated trajectories calculated between consecutive footprints to estimate the paths taken by the trackmaker.  
3. **Handles missing footprints (if applicable):** When dealing with incomplete tracks (e.g., footprints lost due to erosion or gaps in the trackway), the function can interpolate these gaps if the argument `missing = TRUE` is used.  

### **Explanation of Arguments:**  
- **`scale`:** This argument is a scaling factor that converts digitized coordinates to real-world measurements (e.g., meters).  
- **`missing`:** A logical value indicating whether some footprints are missing (`TRUE`) or not (`FALSE`).  
- **`NAs`:** A matrix specifying which footprints are missing, if applicable. This is set to `NULL` if no footprints are missing.  

Here, the TPS files (**PaluxyRiver.tps** and **MountTom.tps**) are loaded using the `system.file()` function to ensure compatibility across systems. They are then converted to track objects using the `tps_to_track()` function. The `scale` argument is used to set the coordinate scaling factor. For the **PaluxyRiver** dataset, no footprints are missing, so the `missing` argument is set to `FALSE` and `NAs = NULL`. For the **MountTom** dataset, some footprints are missing, so the `missing` argument is set to `TRUE`, and the missing footprints are specified using the `NAs` matrix. Additionally, the `R.L.side` argument is provided to specify the side of the first footprint of each track (either "R" for right or "L" for left).

For users working with their own data, **replace** `system.file("extdata", "PaluxyRiver.tps", package = "QuAnTeTrack")` and `system.file("extdata", "MountTom.tps", package = "QuAnTeTrack")` with the **file paths to your .TPS files** (e.g., `"C:/path/to/your/PaluxyRiver.tps"` and `"C:/path/to/your/MountTom.tps"`).  

```{r, eval=FALSE}
PaluxyRiver <- tps_to_track(
  system.file("extdata", "PaluxyRiver.tps", package = "QuAnTeTrack"),
  scale = 0.004341493,
  missing = FALSE,
  NAs = NULL
)
```

```{r, eval=FALSE}
MountTom <- tps_to_track(
  system.file("extdata", "MountTom.tps", package = "QuAnTeTrack"),
  scale = 0.004411765,
  missing = TRUE,
  NAs = matrix(c(7, 3), nrow = 1, ncol = 2),
  R.L.side = c(
    "R", "L", "L", "L", "R", "L", "R", "R", "L", "L", "L", "L", "L", 
    "R", "R", "L", "R", "R", "L", "R", "R", "R", "R"
  )
)
```
---

## **Step 2: Plotting Tracks**  

The **`plot_track()`** function provides flexible plotting options to visualize the loaded track data. You can generate plots with default settings or focus on specific aspects of the track data, such as footprints or trackways.  

### **Plotting with Default Settings**  
By default, **`plot_track()`** displays the complete track, including both footprints and interpolated trajectories. This is useful for getting a general overview of the track and its corresponding interpolated pathways.  

```{r echo=TRUE}
plot_track(PaluxyRiver)
```

```{r echo=TRUE}
plot_track(MountTom)
```

### **Plotting Footprints Only**
To visualize only the footprint data without the interpolated trajectories, use the `plot = "Footprints"` argument. This is particularly useful when you want to inspect the original footprint positions without the influence of interpolated tracks.

```{r echo=TRUE}
plot_track(PaluxyRiver, plot = "Footprints")
```

```{r echo=TRUE}
plot_track(MountTom, plot = "Footprints")
```

### **Plotting Trackways Only**  
If you want to focus on the interpolated trackways without displaying the footprints, use the `plot = "Tracks"` argument. This visualization helps analyze the continuity and pattern of movement.  

```{r echo=TRUE}
plot_track(PaluxyRiver, plot = "Tracks")
```

```{r echo=TRUE}
plot_track(MountTom, plot = "Tracks")
```

The `plot_track()` function also allows for various customizations to enhance visualization. Parameters that can be customized include:

- `plot.labels`: Logical value indicating whether to plot labels for each track.  
- `labels`: Custom labels to be displayed for the tracks.  
- `cex.l`: Size of the labels.  
- `box.p`: Size of the boxes around the labels.  
- `alpha.l`: Transparency level of the labels.  
- `colours`: Vector of colors to customize the footprints of different tracks.  
- `shape.f`: Vector specifying the shapes used for footprints.  

Below are some examples illustrating these customizations:  

```{r echo=TRUE}
labels <- paste("Track", seq_along(MountTom[[1]]))
plot_track(MountTom, plot.labels = TRUE, labels = labels, cex.l = 4, box.p = 0.3, alpha.l = 0.7)
```

```{r echo=TRUE}
plot_track(PaluxyRiver, plot = "Footprints", colours = c("purple", "orange"), shape.f = c(15, 18))
```

---

## **Step 3: Extracting Track Parameters**  

The **`track_param()`** function is used to **extract various parameters** from the loaded track objects. This includes information about individual footprints and their spatial relationships, which can be useful for further analysis.


```{r, eval=FALSE}
params_paluxy <- track_param(PaluxyRiver)
```

```{r echo=FALSE}
params_paluxy <- track_param(PaluxyRiver)
```

```{r, eval=FALSE}
params_mount <- track_param(MountTom)
```

```{r echo=FALSE}
params_mount <- track_param(MountTom)
```

The output of **`track_param()`** is a list containing **detailed information** about each track, including **step lengths, stride lengths, turning angles, and other relevant metrics**. This information can be **printed or saved** for further analysis.


## **Step 4: Plotting Direction Data**  

The **`plot_direction()`** function provides several ways to visualize directional data. This can be particularly useful for understanding the overall movement patterns and orientation of the tracks. Below are various plotting options with descriptions of what each plot represents.  

### **Boxplot of Direction Data**  
Boxplots provide a summary of the distribution of directions, including median, quartiles, and outliers. This visualization is useful for comparing general directionality across tracks.  

```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "boxplot")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "boxplot")
```

### **Polar Plot of Step Directions**  
Polar plots show the individual step directions radiating from a central point, providing a detailed visualization of the movement patterns of the tracks.  

```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "polar_steps")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "polar_steps")
```

### **Polar Plot of Average Directions Per Track**  
This plot type averages the directional data for each track, providing a simplified overview of general movement trends.  

```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "polar_average")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "polar_average")
```

### **Faceted Polar Plot of Step Directions**  
Faceted plots display individual step directions for each track in separate panels, allowing for a clearer comparison of movement patterns across multiple tracks.  

```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "faceted")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "faceted")
```

---

### **Further Customizations**  
The **`plot_direction()`** function offers several customization options to enhance the visualization of your data:  

- **`y_breaks_manual`**: Define custom breaks on the radial axis for `polar_average` plots. Example:  
  ```{r echo=TRUE, results='hide'}
  plot_direction(PaluxyRiver, plot_type = "polar_average", y_breaks_manual = c(1, 2))
  ```

- **`y_labels_position`**: Adjust the position of y-axis labels. This can be helpful when fine-tuning polar plots for presentation. Example:  
  ```{r echo=TRUE, results='hide'}
  plot_direction(PaluxyRiver, plot_type = "polar_steps", y_labels_position = -90)
  ```

- **`facet_labels`**: Provide custom labels for faceted plots to improve clarity when comparing multiple tracks.  

These customization options allow you to tailor your plots to best fit your analytical needs and presentation preferences.  






Boxplot of Direction Data
```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "boxplot")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "boxplot")
```

Polar Plot of Step Directions
```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "polar_steps")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "polar_steps")
```

Polar Plot of Average Directions Per Track
```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver,
plot_type = "polar_average")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom,
plot_type = "polar_average")
```

Faceted Polar Plot of Step Directions
```{r echo=TRUE, results='hide'}
plot_direction(PaluxyRiver, plot_type = "faceted")
```

```{r echo=TRUE, results='hide'}
plot_direction(MountTom, plot_type = "faceted")
```







```{r, echo=TRUE, message=FALSE}
H_paluxyriver <- c(3.472, 2.200)
Method_paluxyriver <- c("A", "B")
velocity_paluxyriver <- velocity_track(PaluxyRiver, H = H_paluxyriver, method = Method_paluxyriver)
```


**Example 2: Mount Tom Dataset**

tpsMountTom <- system.file("extdata", "MountTom.tps", package = "QuAnTeTrack")
NAs <- matrix(c(7, 3), nrow = 1, ncol = 2)
MountTom <- tps_to_track(tpsMountTom, scale = 0.004411765, missing = TRUE, NAs = NAs,
                         R.L.side = c("R", "L", "L", "L", "R", "L", "R", "R", "L", "L", 
                                      "L", "L", "L", "R", "R", "L", "R", "R", "L", "R", 
                                      "R", "R", "R"))
plot_track(MountTom)

Display track parameters within a scrollable box
params_mounttom <- track_param(MountTom)
print(params_mounttom)

plot_direction(MountTom, plot_type = "polar_steps")

H_mounttom <- c(1.380, 1.404, 1.320, 1.736, 1.364, 1.432, 1.508, 1.768, 1.600, 1.848, 
                1.532, 1.532, 0.760, 1.532, 1.688, 1.620, 0.636, 1.784, 1.676, 1.872, 
                1.648, 1.760, 1.612)
velocity_mounttom <- velocity_track(MountTom, H = H_mounttom)
print(velocity_mounttom)

