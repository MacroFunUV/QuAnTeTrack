% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/anatomical_error_partitioning.R
\name{anatomical_error_partitioning}
\alias{anatomical_error_partitioning}
\title{Partition anatomical-fidelity uncertainty (simulation-based)}
\usage{
anatomical_error_partitioning(
  data,
  error_radius,
  variables = c("TurnAng", "sdTurnAng", "Distance", "Length", "StLength", "sdStLength",
    "Sinuosity", "Straightness", "TrackWidth", "PaceAng"),
  n_sim = 200,
  distribution = c("uniform", "gaussian"),
  seed = NULL
)
}
\arguments{
\item{data}{A \code{track} R object, which is a list consisting of two elements:
\itemize{
\item \strong{\code{Trajectories}}: A list of interpolated trajectories, where each trajectory is a series of midpoints between consecutive tracks.
\item \strong{\code{tracks}}: A list of data frames containing track coordinates, metadata (e.g., image reference, ID), and a marker indicating whether the track is actual or inferred.
}}

\item{error_radius}{Numeric; single radius (m) applied to all tracks or a numeric vector of length
\code{length(data$tracks)} with per-track tolerances.}

\item{variables}{A character vector of parameters to analyze. Default is
\code{c("TurnAng","sdTurnAng","Distance","Length","StLength","sdStLength",
          "Sinuosity","Straightness","TrackWidth","PaceAng")}.}

\item{n_sim}{Integer; number of Monte Carlo jitter simulations per track. Default is \code{200}.}

\item{distribution}{A character string indicating the jitter model. Options are
\code{"uniform"} (points uniformly within a disk of radius r; default) or
\code{"gaussian"} (SD = r/2 on X and Y, truncated at 3 SD).}

\item{seed}{Optional integer for reproducibility. Default is \code{NULL}.}
}
\value{
An \code{"error_partitioning"} R object consisting of a list
containing the following elements:

\item{summary}{Data frame of variance components per variable.
Columns: \code{variable}, \code{component}, \code{variance},
\code{percent}, and \eqn{R^2_c}. Components are \code{track}
(biological), \code{anatomical} (within-track simulation variance),
and \code{Residual} (from the model on simulation means).}

\item{snr}{Data frame with the signal-to-noise ratio per variable.
Columns: \code{variable}, \code{bio_component} (always \code{"track"}),
\code{bio_var}, \code{error_var}, and \code{SNR}. The ratio is
\deqn{SNR = Var(track) / [Var(anatomical) + Var(Residual)].}}

\item{qc}{Compact quality-control table per variable with \code{SNR},
a qualitative \code{SNR_rating} (\code{"weak"}, \code{"moderate"},
\code{"strong"}), the \code{top_component} by percent, its
\code{top_percent}, \eqn{R^2_c}, and an \code{observer_note}
(always \code{"anatomical-only"} for this function).}

\item{models}{\code{NULL}. Placeholder kept for consistency with the
observer-inclusive workflow. No observer models are fitted here.}

\item{analysis_table}{Long data frame with all simulated values for
every track across all Monte Carlo runs (variables joined with track
IDs and simulation labels).}

\item{formulae}{A short note describing the simulation-only
decomposition (within-track anatomical variance from simulations,
plus a random-intercept model on simulation means:
\eqn{y \sim 1 + (1|track)}; angles handled via sine–cosine).}

\item{track_names}{Character vector of internal track labels used in
the analysis.}
}
\description{
\code{anatomical_error_partitioning()} quantifies how much variance in trackway parameters
is due to track landmark placement uncertainty (degree of anatomical fidelity) versus genuine
between-track (biological) differences, using simulation only (no observer effects).
}
\details{
The function estimates how much of the variability in trackway metrics can be
attributed to positional uncertainty in track landmarks, rather than to true
biological differences among trackways. It asks, in essence: "If landmarks
were slightly misplaced by up to \code{error_radius}, how much would that
affect our computed parameters?" For each trackway, landmarks are repeatedly
perturbed within the specified spatial tolerance, the medial trajectory is
reconstructed, and parameters are recalculated across Monte Carlo simulations.
The resulting variance in each metric is then decomposed into a between-track
component (biological signal) and a within-track component (anatomical noise).

The \code{error_radius} represents expected imprecision in reference-point
digitization (e.g., preservation quality, erosion, deformation, or subjective
landmark interpretation). By specifying a realistic tolerance, users can
evaluate how sensitive each metric is to anatomical or taphonomic uncertainty
and identify parameters that remain stable despite imperfect preservation.

For every track and simulation, landmarks are randomly
displaced within a circular area of radius \code{r}, using either a uniform
model (\code{"uniform"}) or a truncated Gaussian on \code{X} and \code{Y}
with \code{SD = r/2} (\code{"gaussian"}, truncated at ±3 SD). Each perturbed
landmark set is converted to a medial trajectory (midpoints between
consecutive footprints, as in \code{tps_to_track()}), and parameters are
recalculated via \code{track_param()}. For each metric \eqn{Y}, total
variance is partitioned via the law of total variance into:
\itemize{
\item \strong{track (biological)} — variance of simulation means among tracks;
\item \strong{anatomical} — mean of within-track variances across simulations;
\item \strong{Residual} — residual from the random-intercept model on
simulation means (no observer terms in this simulation-only setup).
}
Angular variables (\code{TurnAng}, \code{PaceAng}) are embedded in sine–cosine
space to handle circularity and avoid 0°/360° discontinuities (Fisher, 1995).

A signal-to-noise ratio quantifies robustness:
\deqn{\mathrm{SNR} = \frac{\mathrm{Var}(\mathrm{track})}
                {\mathrm{Var}(\mathrm{anatomical}) + \mathrm{Var}(\mathrm{Residual})}.}
As a rule of thumb:
\itemize{
\item \strong{SNR < 1} — anatomical error exceeds biology (weak);
\item \strong{SNR ~ 1–2} — biology and anatomical error are comparable (moderate);
\item \strong{SNR > 2} — biology dominates (strong).
}
A compact QC table reports SNR, the qualitative rating, the top component by
percent, and the conditional \eqn{R^2_c}.
}
\section{Logo}{

\if{html}{\figure{Logo.png}{options: width=120}}
}

\examples{
# Example 1: PaluxyRiver, small jitter (2 cm), uniform noise
# Expect relatively stable metrics and higher SNR.
set.seed(1)
ep_small <- anatomical_error_partitioning(
  data         = PaluxyRiver,
  error_radius = 0.02,
  variables    = c("Distance", "Straightness", "TurnAng"),
  n_sim        = 10
)
ep_small$qc

# Example 2: PaluxyRiver, larger jitter (8 cm) to see SNR drop
# Inflate anatomical uncertainty; SNR should typically decrease.
set.seed(1)
ep_large <- anatomical_error_partitioning(
  data         = PaluxyRiver,
  error_radius = 0.08,
  variables    = c("Distance", "Straightness", "TurnAng"),
  n_sim        = 10
)
ep_large$qc

# Example 3: MountTom subset + Gaussian jitter (3 cm, truncated at ±3 SD)
# Demonstrates alternative noise model and a reduced dataset.
sbMountTom <- subset_track(
  MountTom,
  tracks = c(1, 2, 3, 4, 7, 8, 9, 13, 15, 16, 18)
)
set.seed(2)
ep_gauss <- anatomical_error_partitioning(
  data         = sbMountTom,
  error_radius = 0.03,
  variables    = c("StLength", "sdStLength", "PaceAng"),
  n_sim        = 10,
  distribution = "gaussian"
)
ep_gauss$snr

# Example 4: PaluxyRiver with heterogeneous per-track tolerances
# Alternate 2 cm / 5 cm across tracks; highlights mixed preservation quality.
set.seed(3)
rads <- rep(c(0.02, 0.05),
            length.out = length(PaluxyRiver$Footprints))
ep_het <- anatomical_error_partitioning(
  data         = PaluxyRiver,
  error_radius = rads,
  variables    = c("TrackWidth", "Sinuosity", "PaceAng"),
  n_sim        = 10
)
ep_het$summary

# Example 5: Angles only (circular handling via sine–cosine embedding)
# Focus on orientation metrics; output includes averaged sin/cos components.
set.seed(4)
ep_ang <- anatomical_error_partitioning(
  data         = PaluxyRiver,
  error_radius = 0.04,
  variables    = c("TurnAng", "PaceAng"),
  n_sim        = 10
)
ep_ang$summary

}
\references{
Fisher, N. I. (1995). Statistical Analysis of Circular Data. Cambridge University Press.
}
\seealso{
\code{\link{tps_to_track}}, \code{\link{track_param}}, \code{\link{subset_track}}
}
\author{
Humberto G. Ferrón

humberto.ferron@uv.es

Macroevolution and Functional Morphology Research Group (www.macrofun.es)

Cavanilles Institute of Biodiversity and Evolutionary Biology

Calle Catedrático José Beltrán Martínez, nº 2

46980 Paterna - Valencia - Spain

Phone: +34 (9635) 44477
}
