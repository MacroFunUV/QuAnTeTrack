% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/track_intersection.R
\name{track_intersection}
\alias{track_intersection}
\title{Calculate intersection metrics in tracks}
\usage{
track_intersection(
  data,
  test = NULL,
  H1 = NULL,
  sim = NULL,
  origin.permutation = NULL,
  custom.coord = NULL
)
}
\arguments{
\item{data}{A \code{track} R object, which is a list consisting of two elements:
\itemize{
\item \strong{\code{Trajectories}}: A list of interpolated trajectories, where each trajectory is a series of midpoints between consecutive footprints.
\item \strong{\code{Footprints}}: A list of data frames containing footprint coordinates, metadata (e.g., image reference, ID), and a marker indicating whether the footprint is actual or inferred.
}}

\item{test}{Logical; if \code{TRUE}, the function compares the observed intersection metrics against. Default is \code{FALSE}.}

\item{H1}{A character string specifying the alternative hypothesis to be tested. Options are \code{"Lower"} for testing whether the observed intersections are significantly lower than the simulated ones (e.g., coordinated or gregarious movement), or \code{"Higher"} for testing whether the observed intersections are significantly higher than the simulated ones (e.g., predatory or chasing events).}

\item{sim}{A \code{track simulation} R object consisting of a list of simulated trajectories to use for comparison when \code{test = TRUE}.}

\item{origin.permutation}{A character string specifying the method for permutation of the coordinates of the simulated trajectories' origins.
Options include \code{"None"}, \code{"Min.Box"}, \code{"Conv.Hull"}, or \code{"Custom"}. Default is \code{"None"}.}

\item{custom.coord}{A matrix of custom coordinates that define the vertices of an area for permutation of the coordinates of the simulated
trajectories' origins.}
}
\value{
A \code{track intersection} R object consisting of a list containing the following elements:

\item{Intersection_metric}{A numeric matrix of unique intersection counts between trajectories.
Each entry represents the number of unique intersection points between the corresponding pair of trajectories.}

\item{Intersection_metric_p_values}{(If \code{test = TRUE}) A numeric matrix of raw pairwise \emph{p}-values,
computed by Monte Carlo tail tests according to \code{H1}, with the (+1) correction
(Phipson & Smyth, 2010):
\deqn{p = (1 + \#\{\text{extreme}\}) / (nsim + 1)}.
Each entry reflects the probability of observing an intersection count as extreme as the observed one,
given the null hypothesis of no difference.}

\item{Intersection_metric_p_values_BH}{(If \code{test = TRUE}) A numeric matrix of Benjamini–Hochberg (BH)
adjusted \emph{p}-values controlling the false discovery rate (FDR), applied across the set of unique pairwise tests
(Benjamini & Hochberg, 1995).}

\item{Intersection_metric_p_values_combined}{(If \code{test = TRUE}) A single numeric value representing
the combined \emph{p}-value across all intersections (based on the global statistic: the sum of pairwise intersections).
This indicates the overall significance of the observed intersections relative to simulations.}

\item{Intersection_metric_simulations}{(If \code{test = TRUE}) A list containing matrices of intersection counts
for each simulation iteration, allowing for inspection of the distribution of intersections across randomized scenarios.}
}
\description{
\code{track_intersection()} calculates the number of unique intersections between trajectories.
The function also supports testing with simulations and different permutation procedures for the coordinates
of the simulated trajectories' origins to compute \emph{p}-values. This allows for a robust assessment of the intersection metrics,
enabling users to evaluate the significance of the observed intersections in relation to simulated trajectories.
}
\details{
The \code{track_intersection()} function is designed to calculate the number of unique
intersections between trajectories and to evaluate their statistical significance
through hypothesis testing based on simulated tracks.

Pairwise \emph{p}-values are computed with a Monte Carlo tail test according to the
selected alternative hypothesis (\code{H1}), using the (+1) correction to avoid
zero-values (see Phipson & Smyth, 2010):
\deqn{p = (1 + \#\{\text{extreme}\}) / (nsim + 1)}

These raw \emph{p}-values are then adjusted for multiple comparisons across the set
of unique pairwise tests using the Benjamini–Hochberg (BH) procedure for
false discovery rate (FDR) control (Benjamini & Hochberg, 1995). Both the raw and the BH-adjusted \emph{p}-value
matrices are returned in the output object, allowing users to inspect either
uncorrected or corrected results. In addition, a global combined \emph{p}-value is
provided, summarizing the overall deviation from the null across all pairs.

This framework provides a robust means of comparing observed intersections
against those expected under random conditions, and is intended for testing
specific behavioral hypotheses related to trackmaker interactions.

Hypothesis testing is controlled by the \code{H1} argument, which defines the
\strong{alternative hypothesis}:
\itemize{
\item \code{"Lower"}: tests whether the observed intersections are significantly fewer
than those generated by simulations. This scenario corresponds to hypotheses
of \strong{coordinated or gregarious movement}, where parallel or group movement
would result in fewer intersections than expected at random.
\item \code{"Higher"}: tests whether the observed intersections are significantly greater
than those generated by simulations. This scenario corresponds to hypotheses
of \strong{predatory or chasing interactions}, where one trackmaker follows or
crosses another, producing more intersections than expected at random.
}

The choice of \code{H1} must match the biological hypothesis under investigation.
If it is not explicitly specified when \code{test = TRUE}, an error will be raised.

The interpretation of the \strong{combined global \emph{p}-value} returned by the function
is directly influenced by the choice of \code{H1}, as it determines whether the test
detects a reduction or an increase in intersection counts relative to the
simulated dataset.

In addition to hypothesis testing, the \code{track_intersection()} function offers several options for altering the initial positions
of simulated tracks through the \code{origin.permutation} argument. The available options include:
\itemize{
\item \code{"None"}: Simulated trajectories are not shifted and are compared based on their original starting positions.
\item \code{"Min.Box"}: Trajectories are randomly placed within the \strong{minimum bounding box} surrounding the original starting points.
\item \code{"Conv.Hull"}: Trajectories are placed within the \strong{convex hull} that encompasses all original starting points, providing
a more precise representation of the area occupied by the tracks.
\item \code{"Custom"}: Allows users to define a specific region of interest by providing a matrix of coordinates (\code{custom.coord}) that
specifies the vertices of the desired area. This option is particularly useful when certain spatial features or environmental conditions
are known to constrain movement.
}

The choice of \code{origin.permutation} should reflect the nature of the behavioral hypothesis being tested. For example, using
\code{"None"} is most appropriate when testing how intersections compare under scenarios where trackmakers originate from specific
locations. In contrast, options like \code{"Min.Box"}, \code{"Conv.Hull"}, or \code{"Custom"} are suitable when evaluating how intersections
would differ if the tracks originated from a broader or predefined area.

The \code{track_intersection()} function also allows for integration with similarity metrics computed using \code{simil_DTW_metric()} and
\code{simil_Frechet_metric()}. This combination of intersection counts and similarity metrics can provide a more comprehensive analysis
of how trackmakers interacted, whether their movements were coordinated or independent, and whether their interactions were consistent
with the hypothesized behavioral patterns.

Overall, the selection of \code{H1} and \code{origin.permutation} should be carefully considered in light of the specific hypotheses
being tested. By combining intersection metrics with similarity measures, users can obtain a deeper understanding of the
behavioral dynamics underlying the observed trackways.
}
\section{Logo}{

\if{html}{\figure{Logo.png}{options: width=30\%}}
}

\examples{
# Example 1: Intersection metrics in the PaluxyRiver dataset.
s1 <- simulate_track(PaluxyRiver, nsim = 5, model = "Directed")
int1 <- track_intersection(PaluxyRiver, test = TRUE, H1 = "Lower", sim = s1,
origin.permutation = "None")
print(int1)

# Example 2: Using "Min.Box" origin permutation in PaluxyRiver dataset.
s2 <- simulate_track(PaluxyRiver, nsim = 5, model = "Constrained")
int2 <- track_intersection(PaluxyRiver, test = TRUE, H1 = "Lower", sim = s2,
origin.permutation = "Min.Box")
print(int2)

# Example 3: Using "Conv.Hull" origin permutation in PaluxyRiver dataset.
s3 <- simulate_track(PaluxyRiver, nsim = 5, model = "Unconstrained")
int3 <- track_intersection(PaluxyRiver, test = TRUE, H1 = "Lower", sim = s3,
origin.permutation = "Conv.Hull")
print(int3)

# Example 4: Using "Min.Box" origin permutation in MountTom subset.
sbMountTom <- subset_track(MountTom, tracks = c(1, 2, 3, 4, 7, 8, 9, 13, 15, 16, 18))
s4 <- simulate_track(sbMountTom, nsim = 5)
int4 <- track_intersection(sbMountTom, test = TRUE, H1 = "Higher", sim = s4,
origin.permutation = "Min.Box")
print(int4)

# Example 5: Customized origin permutation in MountTom subset.
sbMountTom <- subset_track(MountTom, tracks = c(1, 2, 3, 4, 7, 8, 9, 13, 15, 16, 18))
s5 <- simulate_track(sbMountTom, nsim = 5)
area_origin <- matrix(c(50, 5, 10, 5, 10, 20, 50, 20), ncol = 2, byrow = TRUE)
int5 <- track_intersection(sbMountTom, test = TRUE, H1 = "Higher", sim = s5,
origin.permutation = "Custom", custom.coord = area_origin)
print(int5)

}
\references{
Benjamini, Y., & Hochberg, Y. (1995). Controlling the false discovery rate: a practical and powerful approach to multiple testing.
Journal of the Royal statistical society: series B (Methodological), 57(1), 289-300.

Phipson, B., & Smyth, G. K. (2010). Permutation P-values should never be zero: calculating exact P-values when permutations are randomly drawn.
Statistical applications in genetics and molecular biology, 9(1).
}
\seealso{
\code{\link{tps_to_track}}, \code{\link{simulate_track}}, \code{\link{simil_DTW_metric}}, \code{\link{simil_Frechet_metric}}
}
